import{r as o,j as e,a3 as C,g as P,A as S,a4 as A,a5 as E,a6 as k,a as D,a7 as U,u as q,M as F,a8 as I}from"./index-CivGSquN.js";const M=({onSubmit:s})=>{const[t,l]=o.useState(""),n=r=>{r.preventDefault(),s(t)};return e.jsx("div",{className:"lower-container",children:e.jsxs("form",{onSubmit:n,children:[e.jsx("h2",{children:"비밀번호 확인"}),e.jsx("p",{children:"개인정보 수정을 위해 비밀번호를 입력해주세요."}),e.jsx("input",{className:"pw-input",type:"password",value:t,onChange:r=>l(r.target.value),placeholder:"비밀번호",required:!0}),e.jsx("button",{className:"pw-submit",type:"submit",children:"확인"})]})})},B=C.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),T=async s=>{try{return(await B.post("/user/update/avatar",{avatar:s})).data}catch{throw new Error("Failed to update user avatar")}},R=()=>{var v;const[s,t]=o.useState({id:"",email:"",username:"",avatar:"",exp:0,level:0}),[l,n]=o.useState(""),[r,c]=o.useState(""),[u,h]=o.useState(""),[m,p]=o.useState(""),[x,j]=o.useState(null),d=async()=>{try{const a=await A();t(a.user)}catch(a){console.error("Error fetching user details:",a),alert("사용자 정보를 불러오는 데 실패했습니다.")}};o.useEffect(()=>{d()},[]);const w=async a=>{if(a.preventDefault(),r!==m){alert("새 비밀번호가 일치하지 않습니다.");return}try{await E(u,r),alert("비밀번호가 성공적으로 변경되었습니다."),c(""),h(""),p(""),window.location.reload()}catch(i){console.error("Error changing password:",i),alert("비밀번호 변경에 실패했습니다. 다시 시도해주세요.")}},g=async a=>{a.preventDefault();try{await k(l),alert("이름이 성공적으로 변경되었습니다."),d(),n(""),window.location.reload()}catch(i){console.error("Error changing name:",i),alert("이름 변경에 실패했습니다. 다시 시도해주세요.")}},f=async a=>{if(a.preventDefault(),!x){alert("업로드할 파일을 선택해주세요.");return}try{await T(x),alert("아바타가 성공적으로 변경되었습니다."),d(),j(null),window.location.reload()}catch(i){console.error("Error changing avatar:",i),alert("아바타 변경에 실패했습니다. 다시 시도해주세요.")}},b=a=>{a.target.files&&a.target.files[0]&&j(a.target.files[0])},N=P(s.username),y=D[N];return e.jsxs("div",{className:"personalInfo-container",children:[e.jsxs("div",{className:"info-container",children:[e.jsxs("div",{className:"avatar-container",children:[e.jsx(S,{sx:{backgroundColor:y,width:200,height:200,fontSize:"5rem"},children:((v=s.username)==null?void 0:v.charAt(0).toUpperCase())||""}),e.jsxs("form",{className:"avatar-form",onSubmit:f,children:[e.jsx("label",{htmlFor:"file",children:e.jsx("div",{className:"avatar-input",children:"파일 업로드"})}),e.jsx("input",{type:"file",name:"file",id:"file",accept:".png,.jpg,.jpeg",onChange:b,required:!0}),e.jsx("button",{className:"avatar-button",type:"submit",children:"변경"})]})]}),e.jsxs("div",{className:"user-container",children:[e.jsx("div",{className:"name-container",children:e.jsxs("label",{children:["Name : ",s.username]})}),e.jsx("div",{className:"username-container",children:e.jsxs("label",{children:["ID : ",s.username]})}),e.jsx("div",{className:"email-container",children:e.jsxs("label",{children:["Email : ",s.email]})}),e.jsx("div",{className:"exp-container",children:e.jsxs("label",{children:["EXP : ",s.exp]})})]})]}),e.jsxs("div",{className:"modify-container",children:[e.jsxs("form",{className:"name-form",onSubmit:g,children:[e.jsx("h3",{children:"이름 변경"}),e.jsx("input",{type:"text",value:l,onChange:a=>n(a.target.value),placeholder:"새 이름",required:!0}),e.jsx("div",{className:"button-container",children:e.jsx("button",{className:"name-button",type:"submit",children:"변경"})})]}),e.jsxs("form",{className:"password-form",onSubmit:w,children:[e.jsx("h3",{children:"비밀번호 변경"}),e.jsx("input",{type:"password",value:u,onChange:a=>h(a.target.value),placeholder:"기존 비밀번호",required:!0}),e.jsx("input",{type:"password",value:r,onChange:a=>c(a.target.value),placeholder:"새 비밀번호",required:!0}),e.jsx("input",{type:"password",value:m,onChange:a=>p(a.target.value),placeholder:"새 비밀번호 확인",required:!0}),e.jsx("div",{className:"button-container",children:e.jsx("button",{className:"password-button",type:"submit",children:"변경"})})]})]})]})},V=()=>{const[s,t]=o.useState(""),l=async n=>{n.preventDefault();try{const r=await U(s);alert(r.message),t(""),window.location.reload()}catch(r){console.error("Error updating user permissions:",r),alert("관리자 권한 업데이트에 실패했습니다. 다시 시도해주세요."),t("")}};return e.jsx("div",{className:"toAdmin-container",children:e.jsxs("form",{className:"toAdmin-form",onSubmit:l,children:[e.jsx("h2",{children:"관리자 권한 획득"}),e.jsx("input",{type:"password",value:s,onChange:n=>t(n.target.value),placeholder:"관리자 비밀번호",required:!0}),e.jsx("button",{className:"toAdmin-button",type:"submit",children:"확인"})]})})},H=()=>{const[s,t]=o.useState(!1),l=q(),n=async r=>{try{await I(r),t(!0)}catch(c){console.error("Password check failed:",c),alert("비밀번호가 일치하지 않습니다. 다시 시도해주세요.")}};return e.jsx(F,{children:e.jsxs("div",{className:"mypage-container",children:[e.jsxs("div",{className:"upper-container",children:[e.jsx("div",{className:"back-btn-container",children:e.jsx("button",{className:"back-button",onClick:()=>l("/"),"aria-label":"Back to Home"})}),e.jsx("h1",{children:"마이페이지"})]}),s?e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(V,{})]}):e.jsx(M,{onSubmit:n})]})})};export{H as default};
//# sourceMappingURL=MyPage-CUxdakLj.js.map
