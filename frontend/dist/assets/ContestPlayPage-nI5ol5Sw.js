import{r as c,j as e,f as C,M as x}from"./index-CivGSquN.js";import{a as E}from"./axiosContest-a7qLFL0E.js";import{g as _}from"./axiosInstance-ByXgwNmE.js";import{D as v,a as D,S as P,I as b,G as w,b as T,c as F}from"./GiveUpButton-D21FeauA.js";import"./axiosMachine-BVJLXleH.js";const L=({endTime:a})=>{const o=()=>{const s=+new Date(a)-+new Date;let d={};return s>0&&(d={Hours:Math.floor(s/36e5%24),Minutes:Math.floor(s/1e3/60%60),Seconds:Math.floor(s/1e3%60)}),d},[l,r]=c.useState(o());c.useEffect(()=>{const s=setTimeout(()=>{r(o())},1e3);return()=>clearTimeout(s)},[a]);const i=[];return Object.keys(l).forEach(s=>{l[s]&&i.push(e.jsxs("span",{children:[l[s]," ",s," "]},s))}),e.jsx("div",{className:"timer",children:i.length?i:e.jsx("span",{children:"Contest Ended"})})},H=()=>{const{contestId:a}=C(),[o,l]=c.useState(null),[r,i]=c.useState(null),[s,d]=c.useState(null),[j,h]=c.useState(null),[g,m]=c.useState(!1),[y,u]=c.useState(!0);c.useEffect(()=>{(async()=>{if(!a){i("Contest ID is missing."),u(!1);return}try{const n=await E(a);console.log("Contest Details:",n.contest),l(n.contest),u(!1)}catch(n){console.error("Error fetching contest details:",n),i(n.msg||"Failed to fetch contest details."),u(!1)}})()},[a]);const I=async t=>{d(t),m(!1),h(null);try{const n=await _(t._id);if(console.log("Instance Response:",n),n.instances&&n.instances.length>0){m(!0);const p=n.instances[0];h(p.status),console.log("Existing Instance Found:",p)}else m(!1),h(null),console.log("No Existing Instance Found")}catch(n){console.error("Error fetching instances:",n),i("Failed to fetch instance details.")}},S=t=>{console.log("Instance status changed to:",t),h(t)},N=()=>{console.log("Instance has been started."),m(!0)};if(r)return e.jsx(x,{children:e.jsxs("div",{className:"contest-play-container",children:[e.jsx("h2",{children:"Contest Play"}),e.jsx("div",{className:"error-message",children:r})]})});if(!o||y)return e.jsx(x,{children:e.jsxs("div",{className:"contest-play-container",children:[e.jsx("h2",{children:"Contest Play"}),e.jsx("div",{children:"Loading contest details..."})]})});const f=j==="running";return e.jsx(x,{children:e.jsxs("div",{className:"contest-play-container",children:[e.jsx("div",{className:"contest-play-title",children:e.jsx("h2",{children:"Contest Play"})}),e.jsx("div",{className:"contest-play-name",children:e.jsxs("h3",{children:["Contest: ",o.name]})}),e.jsx("div",{className:"contest-play-timer",children:e.jsx(L,{endTime:o.endTime})}),e.jsxs("div",{className:"select-machines",children:[e.jsx("h3",{children:"Select a Machine:"}),e.jsx("ul",{className:"select-machine-list",children:o.machines.map(t=>e.jsx("li",{className:`select-machine-item ${(s==null?void 0:s._id)===t._id?"selected":""}`,onClick:()=>I(t),style:{cursor:"pointer",padding:"10px",border:(s==null?void 0:s._id)===t._id?"2px solid blue":"1px solid #ccc",marginBottom:"5px",borderRadius:"4px"},children:t.name},t._id))})]}),s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"contest-play-name",children:e.jsxs("h3",{children:["Now Playing: ",s.name]})}),e.jsx(v,{reward:o.contestExp}),e.jsx(D,{}),g?e.jsx(b,{machineId:s._id,onStatusChange:S}):e.jsx(P,{machineId:s._id,onInstanceStarted:N}),e.jsx(w,{machineId:s._id,playType:"contest",contestId:a,disabled:!f}),e.jsx(T,{contestId:a,machineId:s._id,playType:"contest",disabled:!f}),e.jsx(F,{contestId:a,machineId:s._id,machineName:s.name,mode:"contest"})]}):e.jsx("div",{children:"Please select a machine to start playing."})]})})};export{H as default};
//# sourceMappingURL=ContestPlayPage-nI5ol5Sw.js.map
